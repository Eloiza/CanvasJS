<!DOCTYPE html>

<html>

<!-- Ao abrir o link, deve aparecer uma reta. Se o usuário pressionar o mouse sobre um dos cantos, aquele canto da reta será movido enquanto o outro canto da reta fica fixo. Se o mouse for pressionado no centro da reta, a reta toda deve ser movida.
 -->
<body>
	<h1>My First Canvas</h1>
	<canvas id="myCanvas" width="400" height="300" style="border:1px solid #000000;"></canvas>

	<script>

		//armazena dois vetores com as coordenadas de inicio e fim da linha 
		class line{
			constructor(p_ini, p_end, width){
				this.ini = p_ini;
				this.end = p_end;
				this.width = width;
			}
		}

		//armazena uma coordenada em um plano 2d
		class coord{
			constructor(x,y){
				this.x = x;
				this.y = y;
			}
		}

		//inicializando canvas do JS
		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");

		//configurando aparencia da reta
		ctx.lineWidth = 10;
		ctx.lineCap = 'round';
		ctx.strokeStyle = 'green';

		//Desenhando uma linha no canvas
		ctx.moveTo(50,50);
		ctx.lineTo(200,100);
		ctx.stroke();

		//instanciando coordenadas da linha
		let coord_ini = new coord(50, 50);
		let coord_end = new coord(200, 100);

		//instanciando objeto do tipo linha
		line_0 = new line(coord_ini, coord_end, 10);

		//inicializa coordenadas do mouse
		mouse_coord = new coord(0,0);

		//adicionando evento ao clicar na tela
		window.addEventListener('load', ()=>{
			canvas.addEventListener("mousedown",select);
		});

		//atualiza posicao do ponteiro do mouse
		function getPosition(event){
			mouse_coord.x = event.clientX - canvas.offsetLeft;
			mouse_coord.y = event.clientY - canvas.offsetTop;
		}

		//verifica se o clique do mouse convergiu com algum elemento
		function colide(event){
			alert("TO NO COLIDE")

			var a,b,c,i,resultado, colide;

			colide = 0;
			//checa "retas paralelas" a equacao da reta entre os pontos
			for (i = -line_0.width + 5; i<line_0.width + 5; i++){
				//calculando valores da equacao da reta que passa pelo inicio e fim da linha
				a = (line_0.ini.y + i) - (line_0.end.y + i); 
				b = (line_0.end.x) - (line_0.ini.x);
				c = ((line_0.ini.x)* (line_0.end.y + i)) - ((line_0.end.x) *(line_0.ini.y + i));

				//calculando ax + by + c = 0 - com x,y coordenadas do mouse
				var resultado = mouse_coord.x*a + mouse_coord.y*b + c; 
				if(resultado == 0){
					alert("COLIDIU BIXO");
					colide = 1;
					break;	
				}

			}

			alert("Resultado colide: " + colide)
			return colide;

		}

		//verifica se um elemento foi selecionado pelo clique
		function select(event){
			// alert("CLICOU")
			getPosition(event);	//verifica posicao do mouse
			colide(event);

			// //caso clicou na "area" da linha 0 
			// if(colide(event, line_0)){

			// 	//caso clicou no centro da reta
			// 	if(centro){
			// 		drag_line();
			// 	}

			// 	//caso clicou nas bordas
			// 	else if(bordas){
			// 		edit_line();
			// 	}
			// }
		}

		function drag_line(){

		}

		function edit_line(){

		}


	</script>

</body>
</html>